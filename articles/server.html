<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>R as an MCP server • mcptools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R as an MCP server">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mcptools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/server.html">R as an MCP server</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/mcptools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>R as an MCP server</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/mcptools/blob/main/vignettes/server.Rmd" class="external-link"><code>vignettes/server.Rmd</code></a></small>
      <div class="d-none name"><code>server.Rmd</code></div>
    </div>

    
    
<p>The mcptools package enables apps like Claude Desktop, Claude Code,
and VS Code GitHub Copilot to run R code using the Model Context
Protocol (MCP). This vignette highlights the basics of using mcptools to
launch R-based MCP servers before delving a bit further into advanced
usage.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/posit-dev/mcptools" class="external-link">mcptools</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-basics">The basics<a class="anchor" aria-label="anchor" href="#the-basics"></a>
</h2>
<p>In the context of R as an MCP server, there are three main concept to
understand:</p>
<ul>
<li><p><strong>Clients</strong> are the apps you’d like to connect an R
session to, like Claude Desktop of Claude Code. mcptools supports any
client that supports MCP.</p></li>
<li><p>Clients talk to your R sessions using a <strong>server</strong>.
Each client that supports MCP will provide some entry point to configure
a command and any additional arguments with the client. mcptools’s
command and arguments are <code>Rscript</code> and
<code>-e "mcptools::mcp_server()"</code>. Different clients register
this command in different ways. For example, to use mcptools with the
client Claude Code, you might write
<code>claude mcp add -s "user" r-mcptools -- Rscript -e "mcptools::mcp_server()"</code>.</p></li>
<li><p><strong>Sessions</strong> are the R sessions that the client
ultimately talks to. So, if you have an RStudio or Positron window open,
those applications automatically start up an R session that the client
could potentially talk to. To “opt in” your R sessions to be discovered
by clients, run the R code <code><a href="../reference/server.html">mcptools::mcp_session()</a></code>. You
might want to run this code every time you start up R; to do so, add
<code><a href="../reference/server.html">mcptools::mcp_session()</a></code> to your <code>.Rprofile</code>,
perhaps by first calling <code>usethis::edit_r_profile()</code>.
Configuring sessions is not required; if you choose not to do so, tools
will be exucuted in the server itself.</p></li>
</ul>
<p>(In case this caught your eye: yes, the server is itself an R
session. In mcptools’s documentation, we’ll always refer to the server R
session just as the server; the fact that it’s implemented in R is only
a technical detail.)</p>
<p>In the case you have some client that you want to connect to R,
<strong>all you need to do is configure the command</strong>
<code>Rscript -e "mcptools::mcp_server()"</code> according to your
client’s instructions. Optionally, if you’d like the server to be able
to access variables in active R sessions, add
<code><a href="../reference/server.html">mcptools::mcp_session()</a></code> to your <code>.Rprofile</code>,
perhaps by first calling <code>usethis::edit_r_profile()</code>.</p>
<p>Then, you’re good to go!</p>
</div>
<div class="section level2">
<h2 id="multiple-clients-and-r-sessions">Multiple clients and R sessions<a class="anchor" aria-label="anchor" href="#multiple-clients-and-r-sessions"></a>
</h2>
<p>While a single client and a single R session probably covers many
users’ use cases, mcptools supports multiple clients and multiple R
sessions. For example, for the former, you may be both chatting in
Claude Desktop and running Claude Code in a terminal somewhere. Or, in
the multiple R sessions situation, you may have two or more Positron
instances running at once, with different data science projects in
each.</p>
<p><strong>As for multiple clients,</strong> this will “just work”;
there’s nothing to keep in mind here.</p>
<p><strong>As for multiple R sessions</strong>, mcptools will choose a
default R session for your model to talk to without the client knowing
it even had multiple options. So, you might have a project “goats” open
in one Positron window and another project, “sheep”, open in another
Positron window. mcptools provides models with two tools to facilitate
toggling between sessions. The first, <code>list_r_sessions()</code>,
allows the client to “discover” R sessions available to it by their
working directory and (inferred) IDE. Then, the tool
<code>select_r_session()</code> allows the client to (persistently)
choose an R session. So, you could write “In my goats R session,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>o</mi><mi>m</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">some question</annotation></semantics></math>.”
In that case, the model might call <code>list_r_sessions()</code> to
find the full identifier for that goats session, then
<code>select_r_session()</code>, then whatever other tools it will use
to respond to your question. Notably, if you ask a follow-up question
(and you haven’t closed the Positron window with goats pulled up in the
meantime) in the same client chat, the client doesn’t need to use
<code>list_r_sessions()</code> and <code>select_r_session()</code>
again, and can just call whatever tools it needs to answer your
follow-up. <!--# [TODO: include links to example chats here] --></p>
<p><strong>As for both multiple clients and multiple R
sessions</strong>, this will generally “just work.” That said, do note
that clients can only be connected to one R session at a time. For most
clients, like Claude Code, this isn’t much of an issue. For chat apps
like Claude Desktop, though, you may run into hiccups when you have
multiple chats actively going at the same time. For example, imagine I
ask Claude via Claude Desktop about some problem in my R session “goats”
and then, a moment later, spin up a different chat and ask about my
“sheep” project. In the second chat, Claude will likely use
<code>select_r_session()</code> to choose the “sheep” project. If I then
go back to the chat about “goats” and ask a follow-up, the R session
that any tool calls dispatch to will actually also be the “sheep”
project. If the tool call, say, reads documentation, this isn’t an
issue. If the tool call describe some variable in the global
environment, though, the value of that variable may not exist in—or be
different in—the “sheep” project.
<!--# [TODO: include a link to the "secret password" chat.] --></p>
</div>
<div class="section level2">
<h2 id="custom-tools">Custom tools<a class="anchor" aria-label="anchor" href="#custom-tools"></a>
</h2>
<p>By default, mcptools supplies clients with only the necessary
infrastructural tools to implement interaction with active sessions. You
may be interested in using mcptools via <a href="https://posit-dev.github.io/btw" class="external-link">btw’s wrappers</a>, which provide
a set of atomic tools for data science. These tools allow clients
to:</p>
<ul>
<li><p>Peruse package documentation</p></li>
<li><p>Describe R session information and variables from the global
environment</p></li>
<li><p>Run queries against data sources</p></li>
</ul>
<p>Users might be interested in extending these tools or supplying
completely different ones. For example, you might register:</p>
<ul>
<li>A set of tools specifically focused on R package development
(e.g. various wrappers of <a href="https://devtools.r-lib.org/" class="external-link">devtools</a> and <a href="https://testthat.r-lib.org/" class="external-link">testthat</a>) that could be hooked up
to Claude Code to make a package development assistant.</li>
<li>For the brave, a tool <code>run_r_code()</code> that allows a client
to run whatever R code it wants.</li>
</ul>
<p>You can configure any set of tools that could be passed to the
<code>$set_tools()</code> method of an ellmer Chat object as the tools
that mcptools will supply to clients. To do so, supply a list of outputs
from <code><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">ellmer::tool()</a></code> to the <code>tools</code> argument of
<code><a href="../reference/server.html">mcp_server()</a></code>. Relatedly, you’ll need to make sure that your
code that specifies the new tools can run in a fresh R session; be sure
to either namespace functions from libraries (like
<code><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">ellmer::tool()</a></code> instead of <code><a href="https://ellmer.tidyverse.org/reference/tool.html" class="external-link">tool()</a></code>) or load the
libraries entirely.</p>
<!--# \[TODO: provide an example of registering the `rnorm()` tool.\] -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch, Winston Chang, Charlie Gao, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
